# Curator Agent Plan

## Overview
The **Curator Agent** is responsible for selecting the final lineup of stories to be covered on *TheBoldUnknown* Instagram. It acts as the final editorial filter, taking the raw "leads" generated by the `lead-gen-code` agent and selecting the top 7 stories based on variety, brand alignment, and virality potential.

## Architecture

The agent will be a Python application residing in the `curator/` directory, mirroring the structure of `lead-gen-code`.

### Directory Structure
```
curator/
├── config.py           # Configuration (Env vars, Model IDs)
├── db.py               # Database interactions (Read leads, Write selections)
├── logic.py            # Core curation logic (Prompt assembly, LLM call)
├── main.py             # Entry point
└── models.py           # Data models (Pydantic)
```

## detailed Steps

### 1. Database Interaction (`db.py`)
- **Connection**: Reuse `psycopg2` connection logic from `lead-gen-code`.
- **Get Latest Upload Date**: 
  - Query: `SELECT MAX(created_at) FROM leads WHERE status = 'published'` (or 'curated').
  - Fallback: If no published stories, default to `NOW() - INTERVAL '7 days'`.
- **Fetch Candidates**:
  - Query: `SELECT id, title, url, summary, brand_score, virality_score, viral_hook FROM leads WHERE created_at > %s AND status != 'rejected'` (assuming we don't want to re-review rejected ones, though the user said "every single story", usually this implies "new batch").
- **Save Results**:
  - Update the selected stories in `leads` table (e.g., set `status = 'approved'` or similar).
  - Alternatively, create a `curated_batches` table to track weekly selections.

### 2. Core Logic (`logic.py`)
- **Model**: Use `gpt-5.1` (configured in `config.py`).
- **Input Preparation**:
  - Read `brand-guide.md` from the project root.
  - Format the candidate stories into a clean JSON or Markdown list.
- **Prompt Strategy**:
  - **Role**: You are the Editor-in-Chief of *TheBoldUnknown*.
  - **Task**: Select exactly 7 stories from the provided list.
  - **Priorities**:
    1. **Variety**: Ensure a mix of topics (e.g., Space, History, Biology, Oddities).
    2. **Brand Fit**: High alignment with the "Quiet WTF" lens.
    3. **Virality**: Strong hooks and engagement potential.
  - **Constraints**: 
    - Output must be valid JSON.
    - Must provide a reasoning for the selection of the *set* (how they balance each other) and individual reasons.

### 3. Execution (`main.py`)
- Orchestrates the flow:
  1. Initialize DB.
  2. Determine start date.
  3. Fetch candidates.
  4. Call GPT-5.1 with the prompt.
  5. Parse response.
  6. Save/Output the selected list.

## Configuration (`config.py`)
- **Model**: `OPENAI_CURATOR_MODEL = "gpt-5.1"`
- **Thresholds**: Any specific min scores (optional, as the LLM will do the weighing).

## Next Steps
1. Create the file structure.
2. Implement `db.py` to fetch data.
3. Implement `logic.py` with the specific system prompt.
4. Run and test.

